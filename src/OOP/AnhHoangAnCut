package OOP;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.Arrays;
import java.util.Scanner;

public class Sach {
	private String idSach;
	private String tenSach;
	private double gia;
	private int namXuatBan;
	private int soLuong;
	private TacGia[] tacGia;
	private TheLoai[] theLoai;
	private NhaXuatBan nhaXuatBan;
	private static double thueVAT = 0.08;

	public Sach() {

	}

	public Sach(String idSach, String tenSach, double gia, int namXuatBan, int soLuong, NhaXuatBan nhaXuatBan,
			TacGia[] tacGia, TheLoai[] theLoai) {
		this.idSach = idSach;
		this.tenSach = tenSach;
		this.gia = gia;
		this.namXuatBan = namXuatBan;
		this.soLuong = soLuong;
		this.nhaXuatBan = nhaXuatBan;
		this.tacGia = tacGia;
		this.theLoai = theLoai;
	}

	public String getIdSach() {
		return idSach;
	}

	public void setIdSach(String idSach) {
		this.idSach = idSach;
	}

	public String getTenSach() {
		return tenSach;
	}

	public void setTenSach(String tenSach) {
		this.tenSach = tenSach;
	}

	public double getGia() {
		return gia;
	}

	public void setGia(double gia) {
		this.gia = gia;
	}

	public int getNamXuatBan() {
		return namXuatBan;
	}

	public void setNamXuatBan(int namXuatBan) {
		this.namXuatBan = namXuatBan;
	}

	public int getSoLuong() {
		return soLuong;
	}

	public void setSoLuong(int soLuong) {
		this.soLuong = soLuong;
	}

	public TacGia[] getTacGia() {
		return tacGia;
	}

	public void setTacGia(TacGia[] tacGia) {
		this.tacGia = tacGia;
	}

	public TheLoai[] getTheLoai() {
		return theLoai;
	}

	public void setTheLoai(TheLoai[] theLoai) {
		this.theLoai = theLoai;
	}

	public NhaXuatBan getNhaXuatBan() {
		return nhaXuatBan;
	}

	public void setNhaXuatBan(NhaXuatBan nhaXuatBan) {
		this.nhaXuatBan = nhaXuatBan;
	}

	public static double getThueVAT() {
		return thueVAT;
	}

	public static void setThueVAT(double thueVAT) {
		Sach.thueVAT = thueVAT;
	}

	public double tinhTongTienSauThue(int soLuongMua) {
		double tongTruocThue = gia * soLuongMua;
		double tongSauThue = tongTruocThue * (1 + thueVAT);
		return tongSauThue;
	}

	public static Sach[] docKho() {
		Sach[] ds = new Sach[0];
		try {
			BufferedReader br = new BufferedReader(new FileReader("sach.txt"));
			String line;

			while ((line = br.readLine()) != null) {
				String[] st = line.split(";");

				NhaXuatBan nxb = new NhaXuatBan(st[5], st[6], st[7]);

				String[] idTGs = st[8].split(",");
				String[] tenTGs = st[9].split(",");
				TacGia[] tgArr = new TacGia[tenTGs.length];
				for (int i = 0; i < tenTGs.length; i++) {
					tgArr[i] = new TacGia(idTGs[i].trim(), tenTGs[i].trim());
				}

				String[] idTLs = st[10].split(",");
				String[] tenTLs = st[11].split(",");
				TheLoai[] tlArr = new TheLoai[idTLs.length];
				for (int i = 0; i < idTLs.length; i++) {
					tlArr[i] = new TheLoai(idTLs[i].trim(), tenTLs[i].trim());
				}

				Sach s = new Sach(st[0], st[1], Double.parseDouble(st[2]), Integer.parseInt(st[3]),
						Integer.parseInt(st[4]), nxb, tgArr, tlArr);

				ds = Arrays.copyOf(ds, ds.length + 1);
				ds[ds.length - 1] = s;
			}

			br.close();

		} catch (Exception e) {
			e.printStackTrace();
		}

		return ds;
	}

	public static void ghiFileSach(Sach[] danhSach) {
		try (BufferedWriter bw = new BufferedWriter(new FileWriter("sach.txt"))) {
			for (Sach s : danhSach) {

				String idTGs = "";
				String tenTGs = "";
				for (int i = 0; i < s.getTacGia().length; i++) {
					idTGs += s.getTacGia()[i].getIdTacGia();
					tenTGs += s.getTacGia()[i].getTenTacGia();
					if (i != s.getTacGia().length - 1) {
						idTGs += ",";
						tenTGs += ",";
					}
				}

				String idTLs = "";
				String tenTLs = "";
				for (int i = 0; i < s.getTheLoai().length; i++) {
					idTLs += s.getTheLoai()[i].getIdTheLoai();
					tenTLs += s.getTheLoai()[i].getTenTheLoai();
					if (i != s.getTheLoai().length - 1) {
						idTLs += ",";
						tenTLs += ",";
					}
				}

				String line = s.getIdSach() + ";" + s.getTenSach() + ";" + s.getGia() + ";" + s.getNamXuatBan() + ";"
						+ s.getSoLuong() + ";" + s.getNhaXuatBan().getIdNhaXuatBan() + ";"
						+ s.getNhaXuatBan().getTenNhaXuatBan() + ";" +

						idTGs + ";" + tenTGs + ";" + idTLs + ";" + tenTLs;

				bw.write(line);
				bw.newLine();
			}

			System.out.println("‚úÖ Ghi file Sach.txt th√†nh c√¥ng!");
		} catch (Exception e) {
			System.out.println("‚ùå L·ªói khi ghi file: " + e.getMessage());
		}
	}

	public static void xuatKho() {
		Sach[] ds = docKho();

		if (ds.length == 0) {
			System.out.println("‚ùå Kh√¥ng c√≥ s√°ch n√†o trong kho!");
			return;
		}

		System.out.println(
				"\n=============================================== DANH S√ÅCH S√ÅCH TRONG KHO ===============================================");
		System.out.printf("%-8s | %-30s | %-25s | %-40s | %-12s | %-6s | %-4s | %-25s\n", "ID", "T√™n S√°ch", "T√°c Gi·∫£",
				"Th·ªÉ Lo·∫°i", "Gi√° (VND)", "NƒÉm", "SL", "Nh√† Xu·∫•t B·∫£n");
		System.out.println(
				"--------------------------------------------------------------------------------------------------------------------------"
						+ "---------------------------------------------------------------");

		for (Sach s : ds) {
			StringBuilder tgStr = new StringBuilder();
			for (int i = 0; i < s.getTacGia().length; i++) {
				tgStr.append(s.getTacGia()[i].getTenTacGia());
				if (i != s.getTacGia().length - 1)
					tgStr.append(", ");
			}

			StringBuilder tlStr = new StringBuilder();
			for (int i = 0; i < s.getTheLoai().length; i++) {
				tlStr.append(s.getTheLoai()[i].getTenTheLoai());
				if (i != s.getTheLoai().length - 1)
					tlStr.append(", ");
			}

			System.out.printf("%-8s | %-30s | %-25s | %-40s | %,12.0f | %-6d | %-4d | %-25s\n", s.getIdSach(),
					s.getTenSach(), tgStr.toString(), tlStr.toString(), s.getGia(), s.getNamXuatBan(), s.getSoLuong(),
					s.getNhaXuatBan().getTenNhaXuatBan());
		}

		System.out.println(
				"=========================================================================================================================="
						+ "==============================================================");
	}

	public static Sach[] themSach() {
		Scanner sc = new Scanner(System.in);
		Sach[] ds = docKho();
		System.out.print("Nh·∫≠p s·ªë l∆∞·ª£ng s√°ch mu·ªën th√™m: ");
		int n = Integer.parseInt(sc.nextLine());

		for (int i = 0; i < n; i++) {
			System.out.println("\n===== NH·∫¨P TH√îNG TIN S√ÅCH TH·ª® " + (i + 1) + " =====");

			System.out.print("ID S√°ch: ");
			String idSach = sc.nextLine();

			System.out.print("T√™n S√°ch: ");
			String tenSach = sc.nextLine();

			System.out.print("Gi√°: ");
			double gia = Double.parseDouble(sc.nextLine());

			System.out.print("NƒÉm xu·∫•t b·∫£n: ");
			int namXB = Integer.parseInt(sc.nextLine());

			System.out.print("S·ªë l∆∞·ª£ng: ");
			int soLuong = Integer.parseInt(sc.nextLine());

			System.out.println("Nh·∫≠p th√¥ng tin Nh√† Xu·∫•t B·∫£n:");
			System.out.print("ID NXB: ");
			String idNXB = sc.nextLine();
			System.out.print("T√™n NXB: ");
			String tenNXB = sc.nextLine();
			System.out.print("ƒê·ªãa ch·ªâ NXB: ");
			String diaChiNXB = sc.nextLine();
			NhaXuatBan nxb = new NhaXuatBan(idNXB, tenNXB, diaChiNXB);

			System.out.print("S·ªë l∆∞·ª£ng t√°c gi·∫£: ");
			int soTG = Integer.parseInt(sc.nextLine());
			TacGia[] tacGiaArr = new TacGia[soTG];
			for (int j = 0; j < soTG; j++) {
				System.out.println("T√°c gi·∫£ " + (j + 1) + ":");
				System.out.print("  ID T√°c Gi·∫£: ");
				String idTG = sc.nextLine();
				System.out.print("  T√™n T√°c Gi·∫£: ");
				String tenTG = sc.nextLine();
				tacGiaArr[j] = new TacGia(idTG, tenTG);
			}

			System.out.print("S·ªë l∆∞·ª£ng th·ªÉ lo·∫°i: ");
			int soTL = Integer.parseInt(sc.nextLine());
			TheLoai[] theLoaiArr = new TheLoai[soTL];
			for (int k = 0; k < soTL; k++) {
				System.out.println("Th·ªÉ lo·∫°i " + (k + 1) + ":");
				System.out.print("  ID Th·ªÉ Lo·∫°i: ");
				String idTL = sc.nextLine();
				System.out.print("  T√™n Th·ªÉ Lo·∫°i: ");
				String tenTL = sc.nextLine();
				theLoaiArr[k] = new TheLoai(idTL, tenTL);
			}

			Sach s = new Sach(idSach, tenSach, gia, namXB, soLuong, nxb, tacGiaArr, theLoaiArr);

			ds = Arrays.copyOf(ds, ds.length + 1);
			ds[ds.length - 1] = s;
		}

		ghiFileSach(ds);
		return ds;
	}

	public void SuaSach() {
		Sach[] ds = docKho();
		Scanner sc = new Scanner(System.in);
		System.out.print("üîß Nh·∫≠p ID s√°ch c·∫ßn ch·ªânh s·ª≠a: ");
		String id = sc.nextLine();
		boolean timThay = false;

		for (Sach s : ds) {
			if (s.getIdSach().equalsIgnoreCase(id)) {
				timThay = true;
				int choice;
				do {
					System.out.println("\n===== CH·ªàNH S·ª¨A S√ÅCH =====");
					System.out.println("1. T√™n s√°ch (" + s.getTenSach() + ")");
					System.out.println("2. Gi√° (" + s.getGia() + ")");
					System.out.println("3. NƒÉm XB (" + s.getNamXuatBan() + ")");
					System.out.println("4. S·ªë l∆∞·ª£ng (" + s.getSoLuong() + ")");
					System.out.println("0. L∆∞u v√† tho√°t");
					System.out.print("Ch·ªçn m·ª•c mu·ªën s·ª≠a: ");
					choice = Integer.parseInt(sc.nextLine());

					switch (choice) {
					case 1:
						System.out.print("Nh·∫≠p t√™n m·ªõi: ");
						s.setTenSach(sc.nextLine());
						break;
					case 2:
						System.out.print("Nh·∫≠p gi√° m·ªõi: ");
						s.setGia(Double.parseDouble(sc.nextLine()));
						break;
					case 3:
						System.out.print("Nh·∫≠p nƒÉm XB m·ªõi: ");
						s.setNamXuatBan(Integer.parseInt(sc.nextLine()));
						break;
					case 4:
						System.out.print("Nh·∫≠p s·ªë l∆∞·ª£ng m·ªõi: ");
						s.setSoLuong(Integer.parseInt(sc.nextLine()));
						break;
					case 0:
						ghiFileSach(ds);
						System.out.println("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");
						break;
					default:
						System.out.println("‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
					}
				} while (choice != 0);
				break;
			}
		}

		if (!timThay) {
			System.out.println("‚ùå Kh√¥ng t√¨m th·∫•y s√°ch c√≥ ID: " + id);
		}
	}

	public static void suaTheoID(String idSua) {
		Scanner sc = new Scanner(System.in);
		Sach[] ds = docKho();

		boolean found = false;

		for (Sach s : ds) {
			if (s.getIdSach().equalsIgnoreCase(idSua.trim())) {
				found = true;

				while (true) {
					System.out.println("\n===== CH·ªàNH S·ª¨A TH√îNG TIN S√ÅCH =====");
					System.out.println("1. T√™n s√°ch       (Hi·ªán t·∫°i: " + s.getTenSach() + ")");
					System.out.println("2. Gi√°            (Hi·ªán t·∫°i: " + s.getGia() + ")");
					System.out.println("3. NƒÉm xu·∫•t b·∫£n   (Hi·ªán t·∫°i: " + s.getNamXuatBan() + ")");
					System.out.println("4. S·ªë l∆∞·ª£ng       (Hi·ªán t·∫°i: " + s.getSoLuong() + ")");
					System.out.println("5. Nh√† xu·∫•t b·∫£n   (Hi·ªán t·∫°i: " + s.getNhaXuatBan().getTenNhaXuatBan() + ")");
					String tgStr = "";
					for (int i = 0; i < s.getTacGia().length; i++) {
						tgStr += s.getTacGia()[i].getIdTacGia() + " - " + s.getTacGia()[i].getTenTacGia();
						if (i != s.getTacGia().length - 1)
							tgStr += ", ";
					}

					String tlStr = "";
					for (int i = 0; i < s.getTheLoai().length; i++) {
						tlStr += s.getTheLoai()[i].getIdTheLoai() + " - " + s.getTheLoai()[i].getTenTheLoai();
						if (i != s.getTheLoai().length - 1)
							tlStr += ", ";
					}

					System.out.println("6. T√°c gi·∫£        (Hi·ªán t·∫°i: " + tgStr + ")");
					System.out.println("7. Th·ªÉ lo·∫°i       (Hi·ªán t·∫°i: " + tlStr + ")");
					System.out.println("0. üíæ L∆∞u v√† tho√°t");
					System.out.print("üëâ Ch·ªçn m·ª•c b·∫°n mu·ªën s·ª≠a (0‚Äì7): ");

					int chon = sc.nextInt();
					sc.nextLine();

					switch (chon) {
					case 1: {
						System.out.print("Nh·∫≠p t√™n s√°ch m·ªõi: ");
						s.setTenSach(sc.nextLine());
						break;
					}
					case 2: {
						System.out.print("Nh·∫≠p gi√° m·ªõi: ");
						s.setGia(Double.parseDouble(sc.nextLine()));
						break;
					}
					case 3: {
						System.out.print("Nh·∫≠p nƒÉm xu·∫•t b·∫£n m·ªõi: ");
						s.setNamXuatBan(Integer.parseInt(sc.nextLine()));
						break;
					}
					case 4: {
						System.out.print("Nh·∫≠p s·ªë l∆∞·ª£ng m·ªõi: ");
						s.setSoLuong(Integer.parseInt(sc.nextLine()));
						break;
					}
					case 5: {
						System.out.print("Nh·∫≠p t√™n nh√† xu·∫•t b·∫£n m·ªõi: ");
						String tenNxb = sc.nextLine();
						s.getNhaXuatBan().setTenNhaXuatBan(tenNxb);
						break;
					}
					case 6: {
						System.out.print("Nh·∫≠p s·ªë l∆∞·ª£ng t√°c gi·∫£ m·ªõi: ");
						int n = Integer.parseInt(sc.nextLine());
						TacGia[] tgArr = new TacGia[n];
						for (int i = 0; i < n; i++) {
							System.out.print("ID t√°c gi·∫£ " + (i + 1) + ": ");
							String id = sc.nextLine();
							System.out.print("T√™n t√°c gi·∫£ " + (i + 1) + ": ");
							String ten = sc.nextLine();
							tgArr[i] = new TacGia(id, ten);
						}
						s.setTacGia(tgArr);
						break;
					}
					case 7: {
						System.out.print("Nh·∫≠p s·ªë l∆∞·ª£ng th·ªÉ lo·∫°i m·ªõi: ");
						int n = Integer.parseInt(sc.nextLine());
						TheLoai[] tlArr = new TheLoai[n];
						for (int i = 0; i < n; i++) {
							System.out.print("ID th·ªÉ lo·∫°i " + (i + 1) + ": ");
							String id = sc.nextLine();
							System.out.print("T√™n th·ªÉ lo·∫°i " + (i + 1) + ": ");
							String ten = sc.nextLine();
							tlArr[i] = new TheLoai(id, ten);
						}
						s.setTheLoai(tlArr);
						break;
					}
					case 0: {
						System.out.println("üíæ ƒêang l∆∞u d·ªØ li·ªáu...");
						ghiFileSach(ds);
						System.out.println("‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin s√°ch!");
						return;
					}
					default:
						System.out.println("‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
						break;
					}
				}
			}
		}

		if (!found) {
			System.out.println("‚ùå Kh√¥ng t√¨m th·∫•y s√°ch c√≥ ID: " + idSua);
		}
	}

	public static void xoaTheoID(String id) {
		Sach[] ds = docKho();
		boolean found = false;
		Sach[] dsMoi = new Sach[0];
		for (Sach s : ds) {
			if (s.getIdSach().equalsIgnoreCase(id)) {
				found = true;
				System.out.println("‚úÖ ƒê√£ x√≥a s√°ch: " + s.getTenSach());
				continue;
			}

			dsMoi = Arrays.copyOf(dsMoi, dsMoi.length + 1);
			dsMoi[dsMoi.length - 1] = s;
		}

		if (found) {
			ghiFileSach(dsMoi);
		} else {
			System.out.println("‚ùå Kh√¥ng t√¨m th·∫•y s√°ch c√≥ ID: " + id);
		}
	}

	public void inThongTin() {
		System.out.println("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
		System.out.println("üìò ID: " + idSach);
		System.out.println("T√™n: " + tenSach);
		System.out.println("NƒÉm: " + namXuatBan);
		System.out.printf("Gi√°: %,.0f VND\n", gia);
		System.out.println("S·ªë l∆∞·ª£ng t·ªìn: " + soLuong);
		System.out.println("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
	}

	public static int nhapSoLuongHopLe(Sach s) {
		Scanner sc = new Scanner(System.in);
		int soLuong;
		while (true) {
			System.out.print("üëâ Nh·∫≠p s·ªë l∆∞·ª£ng mu·ªën mua: ");
			soLuong = sc.nextInt();
			sc.nextLine();
			if (soLuong <= 0) {
				System.out.println("‚ùå S·ªë l∆∞·ª£ng ph·∫£i > 0. Nh·∫≠p l·∫°i!");
			} else if (soLuong > s.getSoLuong()) {
				System.out.printf("‚ùå Ch·ªâ c√≤n %d cu·ªën trong kho. Nh·∫≠p l·∫°i!\n", s.getSoLuong());
			} else
				break;
		}
		return soLuong;
	}

	// ======== Ghi ƒë∆°n h√†ng v√†o file ========
	public static void ghiDonHang(Sach s, int soLuong) {
		double tongTien = soLuong * s.getGia();
        String ngayDatHang = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd"));
		System.out.printf("üí∞ T·ªïng ti·ªÅn: %,.0f VND\n", tongTien);

		try (FileWriter fw = new FileWriter("DonHang.txt", true)) {
			fw.write("ID:" + s.getIdSach() + " | T√™n:" + s.getTenSach() + " | SL:" + soLuong + " | Gi√°:" + s.getGia()
					+ " | T·ªïng:" + tongTien + "| Ng√†y ƒë·∫∑t h√†ng: " + ngayDatHang + " | TR·∫†NG TH√ÅI: CH·ªú DUY·ªÜT\n");
			System.out.println("‚úÖ ƒê√£ ghi ƒë∆°n h√†ng (ch·ªù duy·ªát).");
		} catch (IOException e) {
			System.out.println("‚ùå L·ªói ghi file: " + e.getMessage());
		}
	}

	// ======== T√åM THEO ID ========
	public static void timTheoID() {
		Scanner sc = new Scanner(System.in);
		System.out.print("Nh·∫≠p ID s√°ch: ");
		String id = sc.nextLine().trim();
		Sach[] ds = docKho();
		Sach[] ketQua = new Sach[ds.length];
		int count = 0;

		for (Sach s : ds) {
			if (s.getIdSach().equalsIgnoreCase(id)) {
				ketQua[count++] = s;
			}
		}

		if (count == 0) {
			System.out.println("‚ùå Kh√¥ng t√¨m th·∫•y s√°ch c√≥ ID: " + id);
			return;
		}

		System.out.println("\n===== K·∫æT QU·∫¢ T√åM KI·∫æM =====");
		for (int i = 0; i < count; i++) {
			System.out.println((i + 1) + ". " + ketQua[i].getTenSach() + " (" + ketQua[i].getIdSach() + ")");
		}

		System.out.print("\nüëâ Nh·∫≠p s·ªë th·ª© t·ª± s√°ch b·∫°n mu·ªën mua (0 ƒë·ªÉ tho√°t): ");
		int chon = sc.nextInt();
		sc.nextLine();

		if (chon == 0)
			return;
		if (chon < 1 || chon > count) {
			System.out.println("‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
			return;
		}

		Sach s = ketQua[chon - 1];
		s.inThongTin();

		if (s.getSoLuong() == 0) {
			System.out.println("‚ùå S√°ch n√†y ƒë√£ h·∫øt h√†ng!");
		} else {
			int soLuong = nhapSoLuongHopLe(s);
			ghiDonHang(s, soLuong);
		}
	}

	// ======== T√åM THEO T√äN ========
	public static void timTheoTen() {
		Scanner sc = new Scanner(System.in);
		System.out.print("Nh·∫≠p t√™n s√°ch: ");
		String ten = sc.nextLine().toLowerCase();
		Sach[] ds = docKho();
		Sach[] ketQua = new Sach[ds.length];
		int count = 0;

		for (Sach s : ds) {
			if (s.getTenSach().toLowerCase().contains(ten)) {
				ketQua[count++] = s;
			}
		}

		if (count == 0) {
			System.out.println("‚ùå Kh√¥ng t√¨m th·∫•y t√™n s√°ch ph√π h·ª£p!");
			return;
		}

		System.out.println("\n===== K·∫æT QU·∫¢ T√åM KI·∫æM =====");
		for (int i = 0; i < count; i++) {
			System.out.println((i + 1) + ". " + ketQua[i].getTenSach() + " (" + ketQua[i].getIdSach() + ")");
		}

		System.out.print("\nüëâ Nh·∫≠p s·ªë th·ª© t·ª± s√°ch b·∫°n mu·ªën mua (0 ƒë·ªÉ tho√°t): ");
		int chon = sc.nextInt();
		sc.nextLine();

		if (chon == 0)
			return;
		if (chon < 1 || chon > count) {
			System.out.println("‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
			return;
		}

		Sach s = ketQua[chon - 1];
		s.inThongTin();

		if (s.getSoLuong() == 0) {
			System.out.println("‚ùå S√°ch n√†y ƒë√£ h·∫øt h√†ng!");
		} else {
			int soLuong = nhapSoLuongHopLe(s);
			ghiDonHang(s, soLuong);
		}
	}

	// ======== T√åM THEO NƒÇM ========
	public static void timTheoNam() {
		Scanner sc = new Scanner(System.in);
		System.out.print("Nh·∫≠p nƒÉm xu·∫•t b·∫£n: ");
		int nam = sc.nextInt();
		sc.nextLine();
		Sach[] ds = docKho();
		Sach[] ketQua = new Sach[ds.length];
		int count = 0;

		for (Sach s : ds) {
			if (s.getNamXuatBan() == nam) {
				ketQua[count++] = s;
			}
		}

		if (count == 0) {
			System.out.println("‚ùå Kh√¥ng c√≥ s√°ch xu·∫•t b·∫£n nƒÉm " + nam);
			return;
		}

		System.out.println("\n===== K·∫æT QU·∫¢ T√åM KI·∫æM =====");
		for (int i = 0; i < count; i++) {
			System.out.println((i + 1) + ". " + ketQua[i].getTenSach() + " (" + ketQua[i].getIdSach() + ")");
		}

		System.out.print("\nüëâ Nh·∫≠p s·ªë th·ª© t·ª± s√°ch b·∫°n mu·ªën mua (0 ƒë·ªÉ tho√°t): ");
		int chon = sc.nextInt();
		sc.nextLine();

		if (chon == 0)
			return;
		if (chon < 1 || chon > count) {
			System.out.println("‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
			return;
		}

		Sach s = ketQua[chon - 1];
		s.inThongTin();

		if (s.getSoLuong() == 0) {
			System.out.println("‚ùå S√°ch n√†y ƒë√£ h·∫øt h√†ng!");
		} else {
			int soLuong = nhapSoLuongHopLe(s);
			ghiDonHang(s, soLuong);
		}
	}

	// ======== T√åM THEO GI√Å ========
	public static void timTheoGia() {
		Scanner sc = new Scanner(System.in);
		System.out.print("Nh·∫≠p kho·∫£ng gi√° (min-max): ");
		String input = sc.nextLine();
		String[] parts = input.split("-");

		if (parts.length != 2) {
			System.out.println("‚ùå Sai ƒë·ªãnh d·∫°ng! V√≠ d·ª•: 50000-150000");
			return;
		}

		double min = Double.parseDouble(parts[0].trim());
		double max = Double.parseDouble(parts[1].trim());

		Sach[] ds = docKho();
		Sach[] ketQua = new Sach[ds.length];
		int count = 0;

		for (Sach s : ds) {
			if (s.getGia() >= min && s.getGia() <= max) {
				ketQua[count++] = s;
			}
		}

		if (count == 0) {
			System.out.println("‚ùå Kh√¥ng c√≥ s√°ch trong kho·∫£ng gi√° n√†y!");
			return;
		}

		System.out.println("\n===== K·∫æT QU·∫¢ T√åM KI·∫æM =====");
		for (int i = 0; i < count; i++) {
			System.out.println((i + 1) + ". " + ketQua[i].getTenSach() + " (" + ketQua[i].getIdSach() + ")");
		}

		System.out.print("\nüëâ Nh·∫≠p s·ªë th·ª© t·ª± s√°ch b·∫°n mu·ªën mua (0 ƒë·ªÉ tho√°t): ");
		int chon = sc.nextInt();
		sc.nextLine();

		if (chon == 0)
			return;
		if (chon < 1 || chon > count) {
			System.out.println("‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
			return;
		}

		Sach s = ketQua[chon - 1];
		s.inThongTin();

		if (s.getSoLuong() == 0) {
			System.out.println("‚ùå S√°ch n√†y ƒë√£ h·∫øt h√†ng!");
		} else {
			int soLuong = nhapSoLuongHopLe(s);
			ghiDonHang(s, soLuong);
		}
	}

	// ======== MENU T√åM KI·∫æM ========
	public static void menuTimKiem() {
		Scanner sc = new Scanner(System.in);
		int chon;
		do {
			System.out.println("\n===== MENU T√åM KI·∫æM S√ÅCH =====");
			System.out.println("1. Theo ID");
			System.out.println("2. Theo t√™n");
			System.out.println("3. Theo nƒÉm xu·∫•t b·∫£n");
			System.out.println("4. Theo gi√°");
			System.out.println("0. Tho√°t");
			System.out.print("Ch·ªçn: ");
			chon = sc.nextInt();
			sc.nextLine();

			switch (chon) {
			case 1 -> timTheoID();
			case 2 -> timTheoTen();
			case 3 -> timTheoNam();
			case 4 -> timTheoGia();
			case 0 -> System.out.println("‚¨Ö Quay l·∫°i menu ch√≠nh");
			default -> System.out.println("‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
			}
		} while (chon != 0);
	}
}
